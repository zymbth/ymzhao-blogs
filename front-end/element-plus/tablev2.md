---
description: Element Plus è™šæ‹ŸåŒ–è¡¨æ ¼ç»„ä»¶çš„ä½¿ç”¨(æ’åºã€ç­›é€‰ã€è‡ªå®šä¹‰å•å…ƒæ ¼æ¸²æŸ“) - ä¸ªäººä½¿ç”¨æ€»ç»“
head:
  - - meta
    - name: keywords
      content: elementplus,è™šæ‹ŸåŒ–è¡¨æ ¼,æ’åº,ç­›é€‰,è‡ªå®šä¹‰
created: '2023-03-13'
---

# Element Plus è™šæ‹ŸåŒ–è¡¨æ ¼ç»„ä»¶çš„ä½¿ç”¨(æ’åºã€ç­›é€‰ã€è‡ªå®šä¹‰å•å…ƒæ ¼æ¸²æŸ“) - ä¸ªäººä½¿ç”¨æ€»ç»“

## å‰è¨€

`element-plus@2.2.0` åæä¾›è™šæ‹ŸåŒ–è¡¨æ ¼ç»„ä»¶ï¼Œè§£å†³è¡¨æ ¼æ•°æ®è¿‡å¤§å¯¼è‡´çš„å¡é¡¿ç­‰æ€§èƒ½é—®é¢˜ã€‚ç›¸å¯¹äºè¡¨æ ¼ç»„ä»¶ï¼Œç”¨æ³•ä¸ŠåŒºåˆ«è¿˜æ˜¯æŒºå¤§çš„ï¼Œå°¤å…¶æ˜¯ä¸€äº›é™„åŠ çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ’åºã€ç­›é€‰ã€è‡ªå®šä¹‰å•å…ƒæ ¼/è¡¨å¤´æ¸²æŸ“ç­‰ç­‰ã€‚

æœ¬æ–‡å‚ç…§å®˜ç½‘æ–‡æ¡£ã€ç¤ºä¾‹ï¼Œç»“åˆä¸ªäººä½¿ç”¨æ€»ç»“ï¼Œæ¼”ç¤ºè™šæ‹ŸåŒ–è¡¨æ ¼çš„åŸºæœ¬ä½¿ç”¨ï¼Œè®°å½•ä¸Šè¿°é™„åŠ åŠŸèƒ½çš„åŸºæœ¬å®ç°ã€‚é™¤ç»„ä»¶çš„ç›¸å…³æ¥å£éœ€è¦æŒ‰ç…§å®˜ç½‘è§„èŒƒä½¿ç”¨å¤–ï¼Œç¤ºä¾‹ä¸­çš„å…¶å®ƒå…·ä½“å®ç°çš„æ–¹æ³•**ä»…ä½œå‚è€ƒ**ï¼Œæä¾›ä½¿ç”¨æ€è·¯ã€‚

åˆ›å»ºäº†ä¸€ä¸ªé¡¹ç›®æ”¶çº³æœ¬æ–‡çš„ä¸€äº› demos:

[Git Page æ¼”ç¤º](https://zymbth.github.io/element-plus-tablev2-demo/)

[element-plus-tablev2-demo](https://github.com/zymbth/element-plus-tablev2-demo)

[element-plus-tablev2-demo (gitee)](https://gitee.com/ymzhao/element-plus-tablev2-demo)

### å®˜æ–¹ä»‹ç»

_â€œåœ¨å‰ç«¯å¼€å‘é¢†åŸŸï¼Œè¡¨æ ¼ä¸€ç›´éƒ½æ˜¯ä¸€ä¸ªé«˜é¢‘å‡ºç°çš„ç»„ä»¶ï¼Œå°¤å…¶æ˜¯åœ¨ä¸­åå°å’Œæ•°æ®åˆ†æåœºæ™¯ã€‚ ä½†æ˜¯ï¼Œå¯¹äº Table V1 æ¥è¯´ï¼Œå½“ä¸€å±é‡Œè¶…è¿‡ 1000 æ¡æ•°æ®è®°å½•æ—¶ï¼Œå°±ä¼šå‡ºç°å¡é¡¿ç­‰æ€§èƒ½é—®é¢˜ï¼Œä½“éªŒä¸æ˜¯å¾ˆå¥½ã€‚
é€šè¿‡è™šæ‹ŸåŒ–è¡¨æ ¼ç»„ä»¶ï¼Œè¶…å¤§æ•°æ®æ¸²æŸ“å°†ä¸å†æ˜¯ä¸€ä¸ªå¤´ç–¼çš„é—®é¢˜ã€‚â€_

### å®˜æ–¹æç¤º

> TIP
>
> è¯¥ç»„ä»¶**ä»åœ¨æµ‹è¯•ä¸­**ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¯èƒ½æœ‰é£é™©ã€‚ è‹¥æ‚¨å‘ç°äº† bug æˆ–é—®é¢˜ï¼Œè¯·äº [GitHub](https://github.com/element-plus/element-plus/issues) æŠ¥å‘Šç»™æˆ‘ä»¬ä»¥ä¾¿ä¿®å¤ã€‚ åŒæ—¶ï¼Œæœ‰ä¸€äº› API å¹¶æœªåœ¨æ­¤æ–‡æ¡£ä¸­æåŠï¼Œå› ä¸ºéƒ¨åˆ†è¿˜æ²¡æœ‰å¼€å‘å®Œå…¨ï¼Œå› æ­¤æˆ‘ä»¬ä¸åœ¨æ­¤æåŠã€‚
>
> **å³ä½¿**è™šæ‹ŸåŒ–çš„è¡¨æ ¼æ˜¯é«˜æ•ˆçš„ï¼Œä½†æ˜¯å½“æ•°æ®è´Ÿè½½è¿‡å¤§æ—¶ï¼Œ**ç½‘ç»œ**å’Œ**å†…å­˜å®¹é‡**ä¹Ÿä¼šæˆä¸ºæ‚¨åº”ç”¨ç¨‹åºçš„ç“¶é¢ˆã€‚ å› æ­¤è¯·ç‰¢è®°ï¼Œè™šæ‹ŸåŒ–è¡¨æ ¼æ°¸è¿œä¸æ˜¯æœ€å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œè¯·è€ƒè™‘æ•°æ®åˆ†é¡µã€è¿‡æ»¤å™¨ç­‰ä¼˜åŒ–æ–¹æ¡ˆã€‚

> TIP
>
> åœ¨ SSR åœºæ™¯ä¸‹ï¼Œæ‚¨éœ€è¦å°†ç»„ä»¶åŒ…è£¹åœ¨ `<client-only></client-only>` ä¹‹ä¸­ (å¦‚: [Nuxt](https://nuxt.com/v3)) å’Œ SSG (ä¾‹å¦‚: [VitePress](https://vitepress.vuejs.org/)).

### å®è·µä¸æ€§èƒ½å¯¹æ¯”

ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨è™šæ‹ŸåŒ–è¡¨æ ¼ï¼Ÿå®ƒé«˜æ€§èƒ½çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿå®ƒçœŸçš„èƒ½æ»¡è¶³ä½ çš„éœ€è¦å—ï¼Ÿç­‰ç­‰ï¼Œè¿™äº›é—®é¢˜æœ¬åº”åœ¨é€‰æ‹©ä½¿ç”¨å®ƒä¹‹å‰å°±ææ˜ç™½ï¼Œå†…å®¹ç•¥å¤šï¼Œæ”¾åœ¨ç»“å°¾å§[ğŸ‘‡](./tablev2#å…«ã€æ€»ç»“)ã€‚

## ä¸€ã€Element Plus è¡¨æ ¼åŸºç¡€

### å±æ€§

è¯¦è§å®˜ç½‘ï¼Œè¿™é‡Œåªè¯´å‡ ç‚¹éœ€è¦æ³¨æ„çš„åœ°æ–¹

- è¡¨æ ¼å±æ€§: width, height å¿…å¡«ï¼ˆå¯ä½¿ç”¨ `AutoResizer` ç»„ä»¶ä½¿è¡¨æ ¼è‡ªåŠ¨è°ƒæ•´å¤§å°ï¼Œä½¿ç”¨æ–¹å¼å‚ç…§å®˜ç½‘ï¼‰
- è¡¨æ ¼å±æ€§ columns ä¸ºåˆ— column çš„é…ç½®æ•°ç»„ï¼Œè¿™æ˜¯ä¸è¡¨æ ¼ç»„ä»¶æœ€å¤§çš„å·®å¼‚ä¹‹ä¸€
- column çš„é…ç½®ä¸­ï¼Œå¯å®šä¹‰å¾ˆå¤šä¹‹å‰å®šä¹‰åœ¨ column æ¨¡æ¿ä¸­çš„å±æ€§
- column çš„é…ç½®å±æ€§ä¸­ï¼ŒcellRenderer è‡ªå®šä¹‰å•å…ƒæ ¼æ¸²æŸ“æ˜¯æœ€å¤§çš„å·®å¼‚ï¼ˆæ¨¡æ¿ ----> jsï¼‰

### ç®€å•ä½¿ç”¨

::: code-group

```html [el-table(TableV1)]
<script setup>
  const columns = [
    { prop: 'name', label: 'Name', width: 100 },
    { prop: 'age', label: 'Age', width: 100 },
    { prop: 'gender', label: 'Gender', width: 100 },
    { prop: 'tel', label: 'Tel', width: 100 },
  ]
  const tableData = [
    { name: '', age: '', gender: '', tel: '' },
    // ...
  ]
</script>
<template>
  <el-table :data="tableData">
    <el-table-column v-for="col in columns" :key="col.prop" v-bind="col" />
  </el-table>
</template>
```

```html [el-table-v2(TableV2)]
<script setup>
  const columns = [
    { key: 'name', dataKey: 'name', title: 'Name', width: 100 },
    { key: 'age', dataKey: 'age', title: 'Age', width: 100 },
    { key: 'gender', dataKey: 'gender', title: 'Gender', width: 100 },
    { key: 'tel', dataKey: 'tel', title: 'Tel', width: 100 },
  ]
  const tableData = [
    { name: '', age: '', gender: '', tel: '' },
    // ...
  ]
</script>
<template>
  <el-table-v2 :columns="columns" :data="tableData" :width="700" :height="400" fixed />
</template>
```

:::

åç»­çš„ç¤ºä¾‹åŸºäº `element-plus@2.2.17`

## äºŒã€è‡ªå®šä¹‰å•å…ƒæ ¼æ¸²æŸ“

### jsx/tsx æˆ– vue æ¸²æŸ“å‡½æ•°

æ³¨æ„ï¼ŒElement Plus çš„è™šæ‹ŸåŒ–è¡¨æ ¼ç»„ä»¶(TableV2)æä¾›çš„è‡ªå®šä¹‰å•å…ƒæ ¼ã€è¡¨å¤´å•å…ƒæ ¼æ¸²æŸ“å™¨éƒ½è¦æ±‚è¿”å› `VNode`ã€‚éœ€è¦ä½¿ç”¨ `jsx/tsx` æˆ–è€… `vue æ¸²æŸ“å‡½æ•°` å®ç°ã€‚å¦‚æ— éœ€ä½¿ç”¨ä¸Šè¿°ä¸¤ä¸ªå•å…ƒæ ¼æ¸²æŸ“å™¨ï¼Œä»…ä½œåŸºæœ¬æ•°æ®å±•ç¤ºã€æ’åºç­‰åŸºæœ¬åŠŸèƒ½çš„è¯ï¼Œå¯ä»¥åƒ TableV1 ä¸€æ ·ç›´æ¥åœ¨ vue å•æ–‡ä»¶ç»„ä»¶å†…ä½¿ç”¨ã€‚

### å‡†å¤‡å·¥ä½œ

æœ¬æ–‡é‡‡ç”¨ `jsx` å®ç°ï¼Œ Vue CLI åˆ›å»ºçš„é¡¹ç›®å¯ç›´æ¥åœ¨ vue å•æ–‡ä»¶ç»„ä»¶çš„ script æ ‡ç­¾ä¸­æ·»åŠ  lang="jsx" (`<script setup lang="jsx">`)

> _â€œ`create-vue` å’Œ Vue CLI éƒ½æœ‰é¢„ç½®çš„ JSX è¯­æ³•æ”¯æŒã€‚å¦‚æœä½ æƒ³æ‰‹åŠ¨é…ç½® JSXï¼Œè¯·å‚é˜… [@vue/babel-plugin-jsx](https://github.com/vuejs/jsx-next) æ–‡æ¡£è·å–æ›´å¤šç»†èŠ‚ã€‚â€_

- `jsx` ç”¨æ³•å¯å‚è€ƒï¼š

> [Vue 3 Babel JSX æ’ä»¶](https://github.com/vuejs/babel-plugin-jsx/blob/dev/packages/babel-plugin-jsx/README-zh_CN.md)
>
> [vue å®˜ç½‘ - æ¸²æŸ“å‡½æ•° & JSX - JSX / TSX](https://cn.vuejs.org/guide/extras/render-function.html#jsx-tsx)
>
> [element-plus è™šæ‹ŸåŒ–è¡¨æ ¼ç»„ä»¶ el-table-v2 æ¸²æŸ“è‡ªå®šä¹‰ç»„ä»¶çš„å…¶ä¸­ä¸¤ç§æ–¹å¼(js å’Œ jsx)åŠæ³¨æ„äº‹é¡¹](https://blog.csdn.net/Mr_WangGeGe/article/details/127275868)
>
> [åœ¨ Vue ä¸­ä½¿ç”¨ JSXï¼Œå¾ˆ easy çš„](https://juejin.cn/post/7018742119082754062)

éœ€æŒæ¡æœ€åŸºæœ¬çš„ æ’å€¼ã€v-ifã€v-forã€v-onã€äº‹ä»¶ä¿®é¥°ç¬¦ã€ç»„ä»¶çš„ jsx è¯­æ³•ï¼Œä»¥åŠç»„ä»¶çš„æ’æ§½è¯­æ³•

- Element Plus å®˜æ–¹æ–‡æ¡£ï¼š

> [Element Plus - Virtualized Table è™šæ‹ŸåŒ–è¡¨æ ¼](https://element-plus.gitee.io/zh-CN/component/table-v2.html)

éœ€äº†è§£è¯¥ç»„ä»¶çš„å¸¸ç”¨å±æ€§æ–¹æ³•ã€Column å±æ€§
æœ¬èŠ‚çš„é‡ç‚¹æ˜¯å•å…ƒæ ¼è‡ªå®šä¹‰æ¸²æŸ“ï¼Œåœ¨äº `cellRenderer` æ–¹æ³•ï¼Œå…¶å‚æ•°ç±»å‹å¦‚ä¸‹ï¼š

```typescript
type CellRenderProps<T> = {
  cellData: T
  column: Column<T>
  columns: Column<T>[]
  columnIndex: number
  rowData: any
  rowIndex: number
}
```

åˆ†åˆ«ä¸º å•å…ƒæ ¼å€¼ã€é¡¹ã€æ‰€æœ‰é¡¹ã€é¡¹ä¸‹æ ‡ã€è¡Œæ•°æ®ã€è¡Œä¸‹æ ‡

### æ¸²æŸ“æ–¹å¼å¯¹æ¯”ï¼ˆel-table vs el-table-v2ï¼‰

`el-table` ä¸­å¸¸ç”¨çš„è‡ªå®šä¹‰å•å…ƒæ ¼æ¸²æŸ“æ–¹å¼ï¼ˆå®šä¹‰åœ¨è¡¨æ ¼ column æ¨¡æ¿ä¸­ï¼‰

`el-table-v2` ä¸­å¸¸ç”¨çš„è‡ªå®šä¹‰å•å…ƒæ ¼æ¸²æŸ“æ–¹å¼ï¼ˆå®šä¹‰åœ¨ column é…ç½®åˆ—è¡¨ä¸­ï¼‰

::: code-group

```html [el-table]
<el-table :data="tableData">
  <el-table-column v-for="col in columns" :key="col.prop" v-bind="col">
    <template #default="{ row }">
      <!-- è‡ªå®šä¹‰å•å…ƒæ ¼æ¸²æŸ“ -->
      <el-tag v-if="col.prop === 'tag'">{{ row[col.prop] }}</el-tag>

      <template v-else-if="col.prop === 'link'">
        <router-link
          v-if="!!row.id"
          :to="{ name: 'TargetRouteName', params: { id: row.id } }"
          >{{ row[col.prop] }}</router-link
        >
        <span v-else>{{ row[col.prop] }}</span>
      </template>

      <template v-else>{{ row[col.prop] }}</template>
    </template>
  </el-table-column>
</el-table>
```

```html [el-table-v2]
<script lang="jsx" setup>
  const columns = [
    {
      key: 'link',
      title: 'Link',
      dataKey: 'link',
      width: 100,
      cellRenderer: ({ cellData, rowData }) => (
        <a href={rowData.link} target='_blank'>Go</a>
      ),
    },
    // ...
  ]
</script>
```

:::

**vue å•æ–‡ä»¶ç»„ä»¶éœ€è¦åœ¨ script ä¸­åŠ ä¸Š`lang="jsx"`**

### å®ä¾‹åˆ—ä¸¾

ä¸ºäº†å¯¹ç…§ï¼Œä¼šåˆ†åˆ«æ”¾ä¸Š `el-table` ä¸ `el-table-v2` çš„è‡ªå®šä¹‰å•å…ƒæ ¼æ¸²æŸ“ä»£ç 

ä¸ºäº†ç²¾ç®€ä»£ç ï¼Œä¸‹è¿° `el-table-v2` çš„ç¤ºä¾‹å‡åªå±•ç¤º `cellRenderer` å‡½æ•°

- ç»„ä»¶

::: code-group

```html [TableV1]
<template v-else-if="col.prop === 'gene'">
  <router-link
    v-if="row.id"
    :to="{ name: 'Target', params: { tid: row.id } }"
    class="gene-text"
    >{{ row[col.prop] || '-' }}</router-link
  >
  <span v-else class="gene-text">{{ row[col.prop] || '-' }}</span>
</template>
```

```js [TableV2]
const cellRenderer = ({ cellData, rowData: row }) => {
  return row.id ? (
    <router-link to={{ name: 'Target', params: { tid: row.id } }} class='gene-text'>
      {cellData ?? '-'}
    </router-link>
  ) : (
    <span class='gene-text'>{cellData ?? '-'}</span>
  )
}
```

:::

åŒ…å«äº†æ’å€¼ã€v-ifã€ç»„ä»¶ã€‚å…¨å±€æ³¨å†Œçš„ç»„ä»¶å¯ç›´æ¥åœ¨ jsx ä¸­ä½¿ç”¨

- v-for

::: code-group

```html [TableV1]
<template v-if="col.prop === 'result'">
  <router-link
    class="gene-source-tag"
    v-for="tag in row[col.prop]"
    :to="{ name: 'TargetAnalysis', params: { tid: row.id, type: tag } }">
    <el-tag>{{ tag }}</el-tag>
  </router-link>
</template>
```

```js [TableV2]
const cellRenderer = ({ cellData, rowData: row }) => {
  return (
    <>
      {cellData?.map(tag => (
        <router-link
          class='gene-source-tag'
          to={{ name: 'TargetAnalysis', params: { tid: row.id, type: tag } }}>
          <el-tag>{tag}</el-tag>
        </router-link>
      )) ?? ''}
    </>
  )
}
```

:::

åŒ…å« v-forã€ç»„ä»¶ã€ç©ºæ ‡ç­¾ã€‚è‹¥å¹¶æœªå…¨å±€å¼•å…¥ Element Plusï¼Œéœ€æ‰‹åŠ¨å¼•å…¥ç›¸å…³ç»„ä»¶ï¼Œå…¶å®ƒè‡ªå®šä¹‰ç»„ä»¶åŒæ ·å¦‚æ­¤ã€‚

## ä¸‰ã€è¡¨å¤´åˆ†ç»„

> æ­¤å‰çš„å¯¹å®˜ç½‘çš„è¡¨å¤´åˆ†ç»„åŠŸèƒ½ç†è§£æœ‰è¯¯ï¼Œå®˜ç½‘æ˜¯é€šè¿‡è¡¨æ ¼å±æ€§ `header-height` æ¥è®¾ç½®å¤šçº§è¡¨å¤´ï¼Œåœ¨æ–°çš„è¡¨å¤´ä¸Šåˆ›å»ºåˆ†ç»„
>
> .
>
> å±æ€§ï¼š`header-height`
>
> æè¿°è¯´æ˜ï¼šHeader çš„é«˜åº¦ç”±`height`è®¾ç½®ã€‚ å¦‚æœä¼ å…¥æ•°ç»„ï¼Œå®ƒä¼šä½¿ header row ç­‰äºæ•°ç»„é•¿åº¦
>
> ç±»å‹ï¼šNumber/Array\<Number\>
>
> é»˜è®¤å€¼ï¼š50
>
> .
>
> ä¸‹é¢çš„åŸdemoå€’ä¹Ÿèƒ½å®ç°åˆ†ç»„ï¼Œè€Œä¸”æ— éœ€é€šè¿‡è®¾ç½®å¤šä¸€çº§è¡¨å¤´æ¥å®ç°
>
> å†è¯´ä¸€éï¼Œå®˜ç½‘çš„è¡¨å¤´åˆ†ç»„demoæ˜¯çœŸçš„sao
>
> ä¸‹é¢çš„ä¸¤ç§åˆ†ç»„å®ç°å‡åœ¨[Git Page æ¼”ç¤º](https://zymbth.github.io/element-plus-tablev2-demo/)ä¸­å¯è§

å®˜æ–¹æ–‡æ¡£åœ¨ TableV2 ä¸Šç»™å‡ºçš„è¯´æ³•æ˜¯â€œè¡¨å¤´åˆ†ç»„â€ï¼Œæ•ˆæœåŒ TableV1 ä¸å¤§ä¸€æ ·ã€‚

V1æ˜¯é€šè¿‡ `<el-table-column>` åµŒå¥—å®ç°ï¼Œæ„ä¹‰æ˜ç¡®ã€å®ç°ç®€å•ï¼Œåˆ›å»ºä¸€ä¸ªåµŒå¥—çš„ `columns` åˆ—è¡¨å°±å¯ä»¥ã€‚

V2çš„å®ç°æ˜¯é€šè¿‡è¡¨æ ¼ç»„ä»¶æä¾›çš„ `header` æ’æ§½

```html
<script setup>
const CustomizedHeader  = ({ cells, columns, headerIndex }) => {
  return cells
}
</script>
<template>
  <el-table-v2
    :columns="columns"
    :data="tableData"
    :width="666"
    :height="666"
  >
    <template #header="props">
      <CustomizedHeader v-bind="props" />
    </template>
  </el-table-v2>
</template>
```

ç±»å‹:

```typescript
type HeaderSlotProps = {
  cells: VNode[]
  columns: Column<any>[]
  headerIndex: number
}
```

### Demo(å¤šä¸€çº§è¡¨å¤´å®ç°è¡¨å¤´åˆ†ç»„)

å®˜ç½‘demoé€šè¿‡æ–°å¢ä¸€çº§è¡¨å¤´æ¥å®ç°åˆ†ç»„ï¼Œ`CustomizedHeader` ç»„ä»¶çš„ç”Ÿæˆè¿‡ç¨‹éå¸¸saoï¼Œå¯¹ç†è§£é€ æˆäº†å¾ˆå¤§å¹²æ‰°ã€‚å®˜æ–¹å·²ç»æŠŠé»˜è®¤ç”Ÿæˆçš„è¡¨å¤´ VNode åˆ—è¡¨æä¾›ç»™æˆ‘ä»¬äº†ï¼Œæˆ‘ä»¬è‡ªè¡Œå¤„ç†ï¼Œè¿”å›ä¸€ä¸ªVNodeåˆ—è¡¨å³å¯ï¼Œéœ€è¦å®ç°è¡¨å¤´åˆ†çº§ï¼Œå¹¶ä¿æŒå¯¹é½ã€‚

å®˜ç½‘çš„è¡¨å¤´åˆ†ç»„æ˜¯æ ¹æ®åºå·è¿›è¡Œçš„ï¼Œå®é™…ä¸Šä¸å®ç”¨ï¼Œè¿™é‡Œé€šè¿‡æ·»åŠ ä¸€ä¸ªåˆ†ç»„æ ‡è¯†æ¥å®ç°

`columns` ä¸­æ·»åŠ  `_group` å±æ€§ï¼Œæ ‡è¯†æ‰€å±åˆ†ç»„ï¼Œ`CustomizedHeader`ç»„ä»¶ä¸­éå†ä¸€éè¡¨å¤´VNodeï¼Œåˆ†ç»„ç›¸åŒçš„è¿ç»­è¡¨å¤´ä¸ºä¸€ä¸ªåˆ†ç»„

demo:

el-table-v2: `:header-height="[36, 50]"` (ä¸¤çº§è¡¨å¤´ï¼Œé«˜åº¦åˆ†åˆ«ä¸º36px, 50px)

::: code-group

```html [template]
<el-table-v2
  :columns="columns"
  :data="tableData"
  :header-height="[36, 50]"
  :width="666"
  :height="666">
  <template #header="props">
    <CustomizedHeader v-bind="props" />
  </template>
</el-table-v2>
```

```js [js]
const columns = [
  { key: 'no', dataKey: 'no', title: 'No.', width: 60 },
  { key: 'code', dataKey: 'code', title: 'code', width: 80, _group: 'Group 1' },
  { key: 'name', dataKey: 'name', title: 'name', width: 80, _group: 'Group 1' },
  { key: 'age', dataKey: 'age', title: 'Age', width: 60, _group: 'Group 2' },
  { key: 'gender', dataKey: 'gender', title: 'gender', width: 80, _group: 'Group 2' },
  { key: 'city', dataKey: 'city', title: 'City', width: 80 },
]

const CustomizedHeader = ({ cells, columns, headerIndex }) => {
  if (headerIndex === 1) return cells
  const groupCells = []
  let currGroupCell = []
  for (let i = 0, len = columns.length; i < len; i++) {
    currGroupCell.push(cells[i])
    if (!columns[i]._group || columns[i]._group !== columns[i + 1]?._group) {
      const width = currGroupCell.reduce((prev, curr) => prev + curr.props.column.width, 0)
      groupCells.push(
        <div class='cell-group' style={{ width: `${width}px` }}>
          {columns[i]._group ?? ''}
        </div>
      )
      currGroupCell = []
    }
  }
  return groupCells
}
```

:::

æ³¨æ„ï¼Œåœ¨ `headerIndex` ä¸º`1`æ—¶ç›´æ¥è¿”å›äº†`cells`ï¼Œè¿™æ˜¯å› ä¸º `:header-height="[36, 50]" ` å¯¹åº”äº†ä¸¤ä¸ªè¡¨å¤´ï¼ˆ`CustomizedHeader`ç»„ä»¶ï¼‰ï¼Œç¬¬äºŒä¸ªè¡¨å¤´ä¸ä½œå¤„ç†ï¼Œç¬¬ä¸€ä¸ªä¸ºåˆ†ç»„è¡¨å¤´ã€‚

### Demo(ä¸å¢åŠ ä¸€çº§è¡¨å¤´)

`CustomizedHeader` ç»„ä»¶å±æ€§ä¸­æä¾›äº†åŸè¡¨å¤´VNodeåˆ—è¡¨ï¼Œä½ å¯ä»¥ä»¥æå¤§è‡ªç”±åº¦åœ°æ“æ§è¿™äº›VNodeæ¥æ”¹å˜è¡¨å¤´ï¼Œä¸Šé¢çš„demoåªæ˜¯å®˜ç½‘æä¾›çš„ä¸€ç§ã€‚

åŒæ ·çš„ `columns`ï¼Œè¡¨æ ¼æ— éœ€é€šè¿‡`header-height`å¢åŠ ä¸€çº§è¡¨å¤´

::: code-group

```html [template]
<el-table-v2
  :columns="columns"
  :data="tableData"
  :width="666"
  :height="666">
  <template #header="props">
    <CustomizedHeader v-bind="props" />
  </template>
</el-table-v2>
```

```js [js]
const CustomizedHeader = ({ cells, columns, headerIndex }) => {
  const groupCells = []
  let currGroupCell = []
  for (let i = 0, len = columns.length; i < len; i++) {
    currGroupCell.push(cells[i])
    if (!columns[i]._group || columns[i]._group !== columns[i + 1]?._group) {
      const width = currGroupCell.reduce((prev, curr) => prev + curr.props.column.width, 0)
      groupCells.push(
        currGroupCell.length > 1 ? (
          <div class='cell-group' style={{ width: `${width}px` }}>
            <div class='group-title'>{columns[i]._group ?? ''}</div>
            <div class='cells-wrap'>{currGroupCell}</div>
          </div>
        ) : (
          currGroupCell[0]
        )
      )
      currGroupCell = []
    }
  }
  return groupCells
}
```

:::

ä¸Šä¾‹ä¸­ï¼Œ`CustomizedHeader`ç»„ä»¶ä¸­å¯¹VNodeçš„å¤„ç†åŒä¸Šä¸€ä¸ªdemoå¾ˆç±»ä¼¼ã€‚ä½†å®ç°äº†ä¸€ç§â€œåˆå¹¶å•å…ƒæ ¼â€çš„æ•ˆæœã€‚é™¤äº†å®½åº¦å¿…é¡»ä¸ºåŸæ¥ä¸¤ä¸ªå•å…ƒæ ¼çš„å®½åº¦ä¹‹å’Œä»¥ä¿è¯å¯¹é½å¤–ï¼Œè¯¥å…ƒç´ çš„å†…å®¹åŠæ ·å¼å‡å¯è‡ªè¡Œè®¾ç½®ã€‚

## å››ã€æ’åº

### ä»‹ç»

TableV1 ç»„ä»¶æ’åºçš„å®ç°è¿‡ç¨‹ï¼š

è®¾ç½® `el-table-column` çš„ `sortable` å±æ€§ä¸º `true` å³å¯ã€‚

å¤šä¸ªæ’åºé—´ç›¸äº’ç‹¬ç«‹

TableV2 æ’åºçš„å®ç°åœ¨æˆ‘çœ‹æ¥æ˜¯â€œè‡ªç”±åº¦å¾ˆé«˜â€çš„ï¼Œé™¤äº†æ ¹æ®å•é¡¹æ’åºè¡¨æ ¼å¤–ï¼Œå®ƒè¿˜æä¾›äº†ä¸€ç§å«â€œå—æ§æ’åºâ€çš„ä¸œè¥¿ï¼ˆå¯ä»¥å®ç°å¤šé‡æ’åºï¼‰ï¼š

é¦–å…ˆï¼Œæ’åºå€¼åªæœ‰ä¸¤ç§ï¼Œå‡/é™åºã€‚æ¸…ç©ºæ’åºéœ€è¦æ‰‹åŠ¨æ¸…ç©ºè®°å½•æ’åºçŠ¶æ€çš„å˜é‡ï¼›

å…¶æ¬¡ï¼Œç»„ä»¶æä¾›äº†æ’åºç›‘å¬äº‹ä»¶(`@column-sort`)ï¼Œä½†å…·ä½“çš„æ’åºæ–¹æ³•éœ€è‡ªè¡Œå®šä¹‰ï¼›

å†æ¬¡ï¼Œä¸åŒäº TableV1 åŒæ—¶åªè¿›è¡Œä¸€é¡¹æ’åºï¼ŒTableV2 å…è®¸å¤šé‡æ’åºã€‚å®ƒå¯ä»¥è®°å½•æ‰€æœ‰å¯æ’åºé¡¹çš„æ’åºçŠ¶æ€ï¼Œä½†å¦‚ä½•å®ç°å¤šé‡æ’åºéœ€è¦ä½ è‡ªå·±åœ¨ç›‘å¬äº‹ä»¶ä¸­å®ç°ã€‚ï¼ˆè‡ªç”±åº¦å¾ˆé«˜ï¼Œä¸€æ–¹é¢éœ€è¦æ‰‹åŠ¨å®ç°å¤šé‡æ’åºæ–¹æ³•ï¼Œå¦ä¸€æ–¹é¢éœ€è¦é€šè¿‡ç®¡ç†æ’åºçŠ¶æ€å˜é‡æ§åˆ¶è¡¨å¤´ UI ä¸Šçš„ä¸‰ç§çŠ¶æ€: å‡/é™/æ— ã€‚ä¸ºäº†é¿å… UI ä¸Šçš„ç–‘æƒ‘ï¼Œè¿™ä¸¤æ–¹é¢éœ€è¦åè°ƒä¸€è‡´ï¼‰

### å…³é”®å±æ€§ã€äº‹ä»¶ã€æ–¹æ³•è¯´æ˜

å…ˆæ”¾ä¸Šä»å®˜ç½‘ä¸Šç²˜è¿‡æ¥çš„ç›¸å…³çš„å±æ€§ã€äº‹ä»¶ã€æ–¹æ³•è¯´æ˜ï¼Œæ–¹ä¾¿å¯¹ç…§åç»­ç¤ºä¾‹å‚è€ƒ

- TableV2 å±æ€§

| å±æ€§å     | æè¿°è¯´æ˜ | ç±»å‹   | é»˜è®¤å€¼    |
| ---------- | -------- | ------ | --------- |
| sort-by    | æ’åºæ–¹å¼ | Object | {}        |
| sort-state | å¤šä¸ªæ’åº | Object | undefined |

- TableV2 äº‹ä»¶

| äº‹ä»¶å      | æè¿°         | å‚æ•°   |
| ----------- | ------------ | ------ |
| column-sort | åˆ—æ’åºæ—¶è°ƒç”¨ | Object |

- Column å±æ€§

| å±æ€§å   | æè¿°             | ç±»å‹    | é»˜è®¤å€¼ |
| -------- | ---------------- | ------- | ------ |
| sortable | è®¾ç½®åˆ—æ˜¯å¦å¯æ’åº | Boolean | -      |

- ç›¸å…³ç±»å‹

```typescript
type KeyType = string | number | symbol

type ColumnSortParam<T> = { column: Column<T>; key: KeyType; order: SortOrder }

enum SortOrder {
  ASC = 'asc',
  DESC = 'desc',
}

type SortBy = { key: KeyType; Order: SortOrder }
type SortState = Record<KeyType, SortOrder>
```

### ä½¿ç”¨ç¤ºä¾‹ï¼ˆå±æ€§ã€äº‹ä»¶ã€æ–¹æ³•ï¼‰

ç¤ºä¾‹åªä¿ç•™äº†æœ€åŸºæœ¬çš„éƒ¨åˆ†ï¼Œæ–¹ä¾¿ç†è§£å¦‚ä½•ä½¿ç”¨ã€‚ç¬¬ä¸‰å°èŠ‚æä¾›äº†å®Œæ•´ demo codepen é“¾æ¥ï¼Œå¯åœ¨çº¿è°ƒè¯•

#### å•é¡¹æ’åº

ä¸€èˆ¬æƒ³è¦çš„å°±æ˜¯è¡¨æ ¼è‹¥å¹²é¡¹å¯ä»¥æ’åºï¼Œä½†åªè¿›è¡Œå•é¡¹æ’åº

```html
<el-table-v2 :sort-by="sortState" @column-sort="onSort" ... />
```

```javascript
// è‡ªè¡Œç¼–å†™æ’åºäº‹ä»¶å¤„ç†æ–¹æ³•
const handleSort = () => {}
// è®°å½•æ’åºçŠ¶æ€, key: æ’åºé¡¹çš„key, order: å‡/é™åº
const sortState = ref({ key: 'no', order: 'asc' })
// ç›‘å¬æ’åºäº‹ä»¶
const onSort = ({ key, order }) => {
  handleSort()
  sortState.value = { key, order }
}
```

#### å¤šé‡æ’åº

ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸ªäººå‘˜è¡¨ï¼Œå¸Œæœ›æŒ‰åŸå¸‚æ’åºï¼ŒåŒä¸€åŸå¸‚çš„æŒ‰æ€§åˆ«æ’åºï¼ŒåŒä¸€æ€§åˆ«çš„æŒ‰å¹´é¾„æ’åº

```html
<el-table-v2 v-model:sort-state="sortState" @column-sort="onSort" ... />
```

```javascript
// äº‹ä»¶å¤„ç†æ–¹æ³•ï¼šè‡ªè¡Œæ ¹æ® sortState å®ç°å¤šé‡æ’åº
const handleSort = () => {}
// ä»¥é”®å€¼å¯¹å½¢å¼è®°å½•æ’åºçŠ¶æ€
const sortState = ref({
  city: 'desc',
  gender: 'asc',
  age: 'asc',
})
// ç›‘å¬æ’åºäº‹ä»¶
const onSort = ({ key, order }) => {
  handleSort()
  sortState.value[key] = order
}
```

#### åœ¨çº¿æ¼”ç¤º

[el-table-v2 å•é¡¹æ’åº demo](https://codepen.io/zymbth/pen/jOvBNex)

[el-table-v2 å¤šé‡æ’åº demo](https://codepen.io/zymbth/pen/KKxWPOG)

## äº”ã€ç­›é€‰/è¿‡æ»¤å™¨

### ä»‹ç»

ç±»ä¼¼äºè‡ªå®šä¹‰å•å…ƒæ ¼æ¸²æŸ“ï¼Œå®ç°ç­›é€‰éœ€è¦é€šè¿‡è‡ªå®šä¹‰è¡¨å¤´å•å…ƒæ ¼æ¸²æŸ“å®ç°

å®˜æ–¹ç¤ºä¾‹æ˜¯åœ¨å¯ç­›é€‰çš„è¡¨å¤´å•å…ƒæ ¼ä¸­æ·»åŠ æ˜¾ç¤ºä¸ºç­›é€‰å›¾æ ‡çš„å¼¹å‡ºæ¡†ï¼ˆ`el-popover` ç»„ä»¶ï¼‰ï¼Œå¼¹å‡ºæ¡†å†…æ˜¾ç¤ºå¯ç­›é€‰é€‰é¡¹ï¼Œé€‰é¡¹åˆ—è¡¨éœ€è¦è‡ªè¡Œè®¡ç®—å¥½ã€‚ç­›é€‰çš„æ‰§è¡Œä¹Ÿéœ€è¦è‡ªè¡Œç›‘å¬å®ç°ï¼Œå’Œæ’åºä¸€æ ·ï¼Œè‡ªç”±åº¦éå¸¸é«˜~

è‡ªå®šä¹‰è¡¨å¤´å•å…ƒæ ¼æ¸²æŸ“ï¼š

```javascript
const columns = [
  {
    // key, dataKey, title, ...
    headerCellRenderer: props => {
      return props.column.title
    },
  },
  // ...
]
```

Column å±æ€§

| å±æ€§å             | æè¿°             | ç±»å‹                                             | é»˜è®¤å€¼ |
| ------------------ | ---------------- | ------------------------------------------------ | ------ |
| headerCellRenderer | è‡ªå®šä¹‰å¤´éƒ¨æ¸²æŸ“å™¨ | VueComponent/(props: HeaderRenderProps) => VNode | -      |

ç±»å‹

```typescript
type HeaderRenderProps<T> = {
  column: Column<T>
  columns: Column<T>[]
  columnIndex: number
  headerIndex: number
}
```

é€šè¿‡åœ¨ `headerCellRenderer` æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªçš„ VNode å®ç°è‡ªå®šä¹‰è¡¨å¤´å•å…ƒæ ¼æ¸²æŸ“

### ä½¿ç”¨ç¤ºä¾‹

ç­›é€‰/è¿‡æ»¤å™¨çš„é«˜è‡ªç”±åº¦å†³å®šäº†å®ƒçš„å…·ä½“å®ç°æ–¹å¼å› äººè€Œå¼‚ï¼Œä»¥ä¸‹ç¤ºä¾‹ä»…ä½œå‚è€ƒã€‚åŒç¬¬äºŒèŠ‚ä¸€æ ·ï¼Œç¤ºä¾‹ä½¿ç”¨çš„æ˜¯ jsx

#### å®ç°è¿‡ç¨‹

é¦–å…ˆï¼Œéœ€è¦æ ‡è¯†å“ªäº› `column` éœ€è¦æ·»åŠ ç­›é€‰åŠŸèƒ½ï¼Œå»¶ç»­ä¸ªäººåœ¨ TableV1 ä¸­çš„ä½¿ç”¨ä¹ æƒ¯ï¼Œåœ¨ `columns` æ•°ç»„ä¸­æ·»åŠ ç›¸å…³å±æ€§ï¼Œ`filterable` æ ‡è¯†è¯¥é¡¹æ˜¯å¦å¯ç­›é€‰ï¼Œ `filterMethod` æŒ‡å®šç­›é€‰æ–¹æ³•

```javascript
import { generalArrFilterHandler } from '@/use/el-table-v2-utils'

const columnData = ref([
  { key: 'no', dataKey: 'no', title: 'No.', width: 60 },
  { key: 'code', dataKey: 'code', title: 'code', width: 80 },
  { key: 'name', dataKey: 'name', title: 'name', width: 80 },
  { key: 'age', dataKey: 'age', title: 'Age', width: 60 },
  { key: 'gender', dataKey: 'gender', title: 'gender', width: 80, filterable: true },
  { key: 'city', dataKey: 'city', title: 'City', width: 80, filterable: true },
  {
    key: 'tags',
    dataKey: 'tags',
    title: 'Tags',
    width: 150,
    filterable: true,
    filterMethod: generalArrFilterHandler,
  },
])
```

ä¸ºäº†é¿å…å¯¹ TableV2 çš„æ½œåœ¨å½±å“ï¼Œè¡¨æ ¼ç»„ä»¶æ‰€ä½¿ç”¨çš„ columns æ•°ç»„ä¸­è¿‡æ»¤æ‰ä¸€äº›ä¸å¿…è¦çš„å±æ€§ï¼Œ`headerCellRenderer` æ–¹æ³•ä¹Ÿéœ€è¦å®šä¹‰åœ¨æ­¤ã€‚

ç¤ºä¾‹ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªå¼¹å‡ºæ¡†ï¼Œç‚¹å‡»ç­›é€‰å›¾æ ‡æ˜¾ç¤ºå¼¹å‡ºæ¡†ï¼Œå¼¹å‡ºæ¡†å†…æ˜¯ä¸€ä¸ªå¤šé€‰æ¡†ç»„ï¼Œç¡®å®šåè¿›è¡Œç­›é€‰

```js
const columns = columnData.value.map(col => {
  return {
    key: col.dataKey,
    title: col.title,
    dataKey: col.dataKey,
    width: col.width ?? 100,
    headerCellRenderer: props => {
      if (!col.filterable) return props.column.title
      return (
        <div class='tbv2-th-filter'>
          <span class='th-cell'>{props.column.title}</span>
          <el-popover trigger='hover' {...{ width: 200 }}>
            {{
              default: () => (
                <div class='filter-wrapper'>
                  <div class='filter-group'>
                    <el-checkbox-group v-model={filterableCols[col.dataKey].selected}>
                      {filterableCols[col.dataKey].list.map(f => (
                        <el-checkbox key={f.value} label={f.value}>
                          {f.text}
                        </el-checkbox>
                      ))}
                    </el-checkbox-group>
                  </div>
                  <div class='el-table-v2__demo-filter'>
                    <el-button text onClick={onFilter}>
                      Confirm
                    </el-button>
                    <el-button text onClick={() => onReset(col.dataKey)}>
                      Reset
                    </el-button>
                  </div>
                </div>
              ),
              reference: () => (
                <svg
                  viewBox='0 0 1024 1024'
                  xmlns='http://www.w3.org/2000/svg'
                  width='14'
                  height='14'
                  style='cursor:pointer'>
                  <path
                    fill='currentColor'
                    d='M735.086 796.233c0-15.58 12.727-28.818 28.891-28.818h230.4a29.257 29.257 0 0 1 28.818 28.818 28.891 28.891 0 0 1-28.745 28.818H763.977a29.257 29.257 0 0 1-28.818-28.818zm0-127.927c0-15.506 12.727-28.745 28.891-28.745h230.4a29.257 29.257 0 0 1 28.818 28.745 28.891 28.891 0 0 1-28.745 28.819H763.977a29.257 29.257 0 0 1-28.818-28.819zm28.891-156.672h230.4a29.257 29.257 0 0 1 28.818 28.819 28.891 28.891 0 0 1-28.745 28.818H763.977a29.257 29.257 0 0 1-28.818-28.818 29.257 29.257 0 0 1 28.818-28.819zM901.632 0c50.176 0 122.149 49.006 121.051 127.927 1.098 35.694-13.897 66.267-42.642 96.768-216.064 189.586-300.178 227.62-306.468 285.257-5.267 45.495-1.829 472.357-2.926 478.135a39.497 39.497 0 0 1-5.778 22.455c-18.432 18.432-37.45 12.141-47.25 4.023-72.046-58.734-232.741-189.514-251.173-228.133-21.358-41.472-13.24-126.757-13.24-276.48 0-34.085-253.512-235.154-308.296-285.257C31.744 210.285 0 181.54 0 128 0 49.59 63.927 0 134.802 0h766.83zM76.069 164.79c1.682 2.341 4.022 5.12 6.875 8.047l8.63 8.63-3.437-3.437a9235.017 9235.017 0 0 0 147.53 125.074l14.92 12.654c134.29 115.2 167.132 147.456 167.132 194.706 0 27.648 0 51.273-.585 88.137-1.756 114.103 0 145.774 8.045 161.353 3.438 6.876 47.836 49.518 108.325 101.961l17.262 14.41c32.914 27.648 57.051 54.125 57.051 51.273V747.813c0-139.996.585-221.184 3.438-244.298 1.755-13.165 5.193-25.892 10.386-38.034 15.58-35.108 40.96-59.246 105.472-111.689l89.234-72.046c40.375-34.596 81.262-69.12 121.637-104.887l-4.608 4.096c19.017-20.187 25.893-35.181 25.307-53.613C959.27 93.915 926.501 64 901.632 64h-766.83c-41.472 0-70.875 26.478-70.875 63.927 0 14.994 4.023 25.892 12.142 36.864z'
                  />
                </svg>
              ),
            }}
          </el-popover>
        </div>
      )
    },
  }
})
```

åˆ«å¿˜äº†ï¼Œç­›é€‰é¡¹å¯ç­›é€‰åˆ—è¡¨ä¹Ÿéœ€è¦è‡ªè¡Œè®¡ç®—å‡ºæ¥ã€‚ `filterableCols` æ˜¯ç”¨æ¥å­˜å‚¨å¯ç­›é€‰é¡¹ç›¸å…³ä¿¡æ¯çš„ï¼Œç¤ºä¾‹ä¸­ï¼Œå®šä¹‰äº†é»˜è®¤çš„ç­›é€‰æ–¹æ³•

```javascript
import { generalFilterHandler } from '@/use/el-table-v2-utils'

const originData = ref([])
const tableData = ref([])

/**
 * ç­›é€‰ä¿¡æ¯åˆ—è¡¨
 * props:
 * - {Array} list å¯ç­›é€‰å€¼åˆ—è¡¨
 * - {Array} selected å·²å‹¾é€‰åˆ—è¡¨
 * - {Function} [filterMethod] ç­›é€‰æ–¹æ³•
 */
const filterableCols = reactive(
  columnData.value
    .filter(c => c.filterable)
    .reduce((prev, curr) => {
      prev[curr.dataKey] = {
        selected: [],
        list: [],
        filterMethod: curr.filterMethod ?? generalFilterHandler,
      }
      return prev
    }, {})
)

// è‡ªåŠ¨è·å–å„é¡¹ç­›é€‰åˆ—è¡¨
const getFiltersFromResp = () => {
  for (let dataKey in filterableCols) {
    let list
    if (dataKey === 'tags') {
      // tags é¡¹å¯ç­›é€‰åˆ—è¡¨å›ºå®š
      list = ['developer', 'Ph.D', 'Bachelor', 'Master', 'CEO', 'HRBP', 'HR'].map(p1 => ({
        text: p1,
        value: p1,
      }))
    } else {
      // å…¶å®ƒé¡¹å–æ‰€æœ‰éé‡å¤é¡¹
      list = originData.value.map(p => p[dataKey]).filter(Boolean)
      // å»é‡ã€è½¬å¯¹è±¡
      list = [...new Set(list)].map(p1 => ({ text: p1, value: p1 }))
    }
    filterableCols[dataKey].list = list
    filterableCols[dataKey].selected = []
  }
}

// const getTableData = () => { ... }
const getData = total => {
  getTableData(total).then(res => {
    originData.value = res ?? []
    tableData.value = originData.value
    getFiltersFromResp()
  })
}
```

ç­›é€‰æ–¹æ³•éœ€è‡ªè¡Œå®šä¹‰

```javascript
const onFilter = () => {
  const allFilters = Object.entries(filterableCols).filter(([_, configs]) => {
    return configs.selected?.length > 0
  })
  tableData.value = originData.value.filter(p => {
    return allFilters.every(([dataKey, configs]) => {
      return !configs.filterMethod || configs.filterMethod(p[dataKey], configs.selected)
    })
  })
}
const onReset = dataKey => {
  filterableCols[dataKey].selected = []
  onFilter()
}
```

#### å®Œæ•´ä»£ç 

::: details

```html
<script lang="jsx" setup>
  import { ref, reactive, onMounted } from 'vue'
  import { generalFilterHandler, generalArrFilterHandler } from '@/use/el-table-v2-utils'

  onMounted(() => {
    getData()
  })

  const originData = ref([])
  const tableData = ref([])
  const columnData = ref([
    { key: 'no', dataKey: 'no', title: 'No.', width: 60 },
    { key: 'code', dataKey: 'code', title: 'code', width: 80 },
    { key: 'name', dataKey: 'name', title: 'name', width: 80 },
    { key: 'age', dataKey: 'age', title: 'Age', width: 60 },
    { key: 'gender', dataKey: 'gender', title: 'gender', width: 80, filterable: true },
    { key: 'city', dataKey: 'city', title: 'City', width: 80, filterable: true },
    {
      key: 'tags',
      dataKey: 'tags',
      title: 'Tags',
      width: 150,
      filterable: true,
      filterMethod: generalArrFilterHandler,
    },
  ])
  const columns = columnData.value.map(col => {
    return {
      key: col.dataKey,
      title: col.title,
      dataKey: col.dataKey,
      width: col.width ?? 100,
      headerCellRenderer: props => {
        if (!col.filterable) return props.column.title
        return (
          <div class='tbv2-th-filter'>
            <span class='th-cell'>{props.column.title}</span>
            <el-popover trigger='hover' {...{ width: 200 }}>
              {{
                default: () => (
                  <div class='filter-wrapper'>
                    <div class='filter-group'>
                      <el-checkbox-group v-model={filterableCols[col.dataKey].selected}>
                        {filterableCols[col.dataKey].list.map(f => (
                          <el-checkbox key={f.value} label={f.value}>
                            {f.text}
                          </el-checkbox>
                        ))}
                      </el-checkbox-group>
                    </div>
                    <div class='el-table-v2__demo-filter'>
                      <el-button text onClick={onFilter}>
                        Confirm
                      </el-button>
                      <el-button text onClick={() => onReset(col.dataKey)}>
                        Reset
                      </el-button>
                    </div>
                  </div>
                ),
                reference: () => (
                  <svg
                    viewBox='0 0 1024 1024'
                    xmlns='http://www.w3.org/2000/svg'
                    width='14'
                    height='14'
                    style={{
                      cursor: 'pointer',
                      color:
                        filterableCols[col.dataKey].selected?.length > 0 ? '#387FE5' : 'inherit',
                    }}>
                    <path
                      fill='currentColor'
                      d='M735.086 796.233c0-15.58 12.727-28.818 28.891-28.818h230.4a29.257 29.257 0 0 1 28.818 28.818 28.891 28.891 0 0 1-28.745 28.818H763.977a29.257 29.257 0 0 1-28.818-28.818zm0-127.927c0-15.506 12.727-28.745 28.891-28.745h230.4a29.257 29.257 0 0 1 28.818 28.745 28.891 28.891 0 0 1-28.745 28.819H763.977a29.257 29.257 0 0 1-28.818-28.819zm28.891-156.672h230.4a29.257 29.257 0 0 1 28.818 28.819 28.891 28.891 0 0 1-28.745 28.818H763.977a29.257 29.257 0 0 1-28.818-28.818 29.257 29.257 0 0 1 28.818-28.819zM901.632 0c50.176 0 122.149 49.006 121.051 127.927 1.098 35.694-13.897 66.267-42.642 96.768-216.064 189.586-300.178 227.62-306.468 285.257-5.267 45.495-1.829 472.357-2.926 478.135a39.497 39.497 0 0 1-5.778 22.455c-18.432 18.432-37.45 12.141-47.25 4.023-72.046-58.734-232.741-189.514-251.173-228.133-21.358-41.472-13.24-126.757-13.24-276.48 0-34.085-253.512-235.154-308.296-285.257C31.744 210.285 0 181.54 0 128 0 49.59 63.927 0 134.802 0h766.83zM76.069 164.79c1.682 2.341 4.022 5.12 6.875 8.047l8.63 8.63-3.437-3.437a9235.017 9235.017 0 0 0 147.53 125.074l14.92 12.654c134.29 115.2 167.132 147.456 167.132 194.706 0 27.648 0 51.273-.585 88.137-1.756 114.103 0 145.774 8.045 161.353 3.438 6.876 47.836 49.518 108.325 101.961l17.262 14.41c32.914 27.648 57.051 54.125 57.051 51.273V747.813c0-139.996.585-221.184 3.438-244.298 1.755-13.165 5.193-25.892 10.386-38.034 15.58-35.108 40.96-59.246 105.472-111.689l89.234-72.046c40.375-34.596 81.262-69.12 121.637-104.887l-4.608 4.096c19.017-20.187 25.893-35.181 25.307-53.613C959.27 93.915 926.501 64 901.632 64h-766.83c-41.472 0-70.875 26.478-70.875 63.927 0 14.994 4.023 25.892 12.142 36.864z'
                    />
                  </svg>
                ),
              }}
            </el-popover>
          </div>
        )
      },
    }
  })

  /**
   * ç­›é€‰ä¿¡æ¯åˆ—è¡¨
   * props:
   * - {Array} list å¯ç­›é€‰å€¼åˆ—è¡¨
   * - {Array} selected å·²å‹¾é€‰åˆ—è¡¨
   * - {Function} [filterMethod] ç­›é€‰æ–¹æ³•
   */
  const filterableCols = reactive(
    columnData.value
      .filter(c => c.filterable)
      .reduce((prev, curr) => {
        prev[curr.dataKey] = {
          selected: [],
          list: [],
          filterMethod: curr.filterMethod ?? generalFilterHandler,
        }
        return prev
      }, {})
  )

  const onFilter = () => {
    const allFilters = Object.entries(filterableCols).filter(([_, configs]) => {
      return configs.selected?.length > 0
    })
    tableData.value = originData.value.filter(p => {
      return allFilters.every(([dataKey, configs]) => {
        return !configs.filterMethod || configs.filterMethod(p[dataKey], configs.selected)
      })
    })
  }
  const onReset = dataKey => {
    filterableCols[dataKey].selected = []
    onFilter()
  }

  const tagList = ['developer', 'Ph.D', 'Bachelor', 'Master', 'CEO', 'HRBP', 'HR']
  // è‡ªåŠ¨è·å–å„é¡¹ç­›é€‰åˆ—è¡¨
  const getFiltersFromResp = () => {
    for (let dataKey in filterableCols) {
      let list
      if (dataKey === 'tags') {
        // tags é¡¹å¯ç­›é€‰åˆ—è¡¨å›ºå®š
        list = tagList.map(p1 => ({ text: p1, value: p1 }))
      } else {
        // å…¶å®ƒé¡¹å–æ‰€æœ‰éé‡å¤é¡¹
        list = originData.value.map(p => p[dataKey]).filter(Boolean)
        // å»é‡ã€è½¬å¯¹è±¡
        list = [...new Set(list)].map(p1 => ({ text: p1, value: p1 }))
      }
      filterableCols[dataKey].list = list
      filterableCols[dataKey].selected = []
    }
  }

  const getData = total => {
    getTableData(total).then(res => {
      originData.value = res ?? []
      tableData.value = originData.value
      getFiltersFromResp()
    })
  }

  const getTableData = total => {
    if (!total) total = Math.floor(Math.random() * 2000 + 1000)
    return new Promise((resolve, reject) => {
      resolve(
        Array.from({ length: total }).map((_, idx) => {
          return {
            no: idx + 1,
            code: Math.floor(Math.random() * 100000).toString(16),
            name: Math.floor(Math.random() * 100000).toString(16),
            age: Math.floor(Math.random() * 30 + 18),
            gender: Math.random() > 0.5 ? 'ç”·' : 'å¥³',
            city: ['åŒ—äº¬', 'ä¸Šæµ·', 'æ·±åœ³'][Math.floor(Math.random() * 3)],
            tags: tagList
              .sort((a, b) => Math.random() - 0.5)
              .slice(0, Math.floor(Math.random() * 4)),
          }
        })
      )
    })
  }
</script>

<template>
  <h3>el-table-v2 ç­›é€‰/è¿‡æ»¤å™¨ demo</h3>
  <el-auto-resizer>
    <template #default="{ height, width }">
      <el-table-v2
        :columns="columns"
        :data="tableData"
        :width="width"
        :height="666"
        :fixed="true" />
    </template>
  </el-auto-resizer>
  <div>Total: {{ tableData.length }}</div>
  <el-button @click="getData()">åˆ·æ–°è¡¨æ ¼æ•°æ®</el-button>
</template>
```

el-table-v2-utils.js:

```js
/**
 * element-plus TableV2 ç­›é€‰æ–¹æ³•
 * @param {string} value å•å…ƒæ ¼æ•°å€¼
 * @param {string|Array} filters å·²é€‰ç­›é€‰å€¼æˆ–ç­›é€‰å€¼åˆ—è¡¨
 * @returns {boolean}
 */
export function generalFilterHandler(value, filters) {
  if (filters instanceof Array) return filterHandler(value, filters)
  return selectFilterHandler(value, filters)
}

/**
 * element-plus TableV2 ç­›é€‰æ–¹æ³•
 * @param {string} value å•å…ƒæ ¼æ•°å€¼
 * @param {Array} filters å·²é€‰ç­›é€‰å€¼åˆ—è¡¨
 * @returns {boolean}
 */
function filterHandler(value, filters) {
  return !filters?.length ? true : filters.includes(value)
}

/**
 * element-plus TableV2 ç­›é€‰æ–¹æ³•
 * @param {string} value å•å…ƒæ ¼æ•°å€¼
 * @param {string} filter å·²é€‰ä¸­çš„ç­›é€‰å€¼
 * @returns {boolean}
 */
function selectFilterHandler(value, filter) {
  return (!filter && filter !== 0) || filter === value
}

/**
 * element-plus TableV2 ç­›é€‰æ–¹æ³•(å•å…ƒæ ¼æ•°å€¼ç±»å‹ä¸ºæ•°ç»„)
 * @param {string|Array} value å•å…ƒæ ¼æ•°å€¼
 * @param {string|Array} filters å·²é€‰ç­›é€‰å€¼æˆ–ç­›é€‰å€¼åˆ—è¡¨
 * @returns {boolean}
 */
export function generalArrFilterHandler(value, filters) {
  if (!(value instanceof Array)) return generalFilterHandler(value, filters)
  if (filters instanceof Array) return arrayFilterHandler(value, filters)
  return selectArrayFilterHandler(value, filters)
}

/**
 * element-plus TableV2 ç­›é€‰æ–¹æ³•(å•å…ƒæ ¼æ•°å€¼ç±»å‹ä¸ºæ•°ç»„)
 * @param {string} value å•å…ƒæ ¼æ•°å€¼
 * @param {Array} filters å·²é€‰ç­›é€‰å€¼åˆ—è¡¨
 * @returns {boolean}
 */
function arrayFilterHandler(value, filters) {
  return !filters?.length ? true : filters.some(f => value?.includes(f))
}

/**
 * element-plus TableV2 ç­›é€‰æ–¹æ³•(å•å…ƒæ ¼æ•°å€¼ç±»å‹ä¸ºæ•°ç»„)
 * @param {string} value å•å…ƒæ ¼æ•°å€¼
 * @param {string} filter å·²é€‰ä¸­çš„ç­›é€‰å€¼
 * @returns {boolean}
 */
function selectArrayFilterHandler(value, filter) {
  return (!filter && filter !== 0) || value?.includes(filter)
}
```

:::

**æ³¨æ„ï¼š** å¯¹å•å…ƒæ ¼æ•°å€¼çš„ç­›é€‰ä¹Ÿåˆ†ä¸ºå¾ˆå¤šç§

- æœ€å¸¸è§çš„ï¼Œå°±æ˜¯åˆ¤æ–­ä¸é€‰ä¸­ç­›é€‰å€¼æ˜¯å¦ç›¸ç­‰(å¤šé€‰æ—¶ï¼Œæ˜¯å¦åŒ…å«åœ¨å†…)ã€‚å…¶å®ƒå¸¸è§çš„åˆ¤æ–­æœ‰åŒ…å«ã€ä»¥...å¼€å¤´ã€ä»¥...ç»“å°¾ã€ç­‰ç­‰
- å…¶æ¬¡ï¼Œä¸Šä¾‹ä¸­æœ‰ä¸ªç‰¹æ®Šçš„é¡¹ï¼Œtagsï¼Œå…¶æ•°æ®ç±»å‹ä¸ºæ•°ç»„ï¼Œéœ€è¦ç­›é€‰å‡ºå­˜åœ¨ tag åŒ…å«åœ¨é€‰ä¸­ tags åˆ—è¡¨ä¸­çš„æ•°æ®ï¼ˆå¦‚ç­›é€‰æ¡ä»¶ä¸ºæ»¡è¶³æ‰€æœ‰é€‰ä¸­ç­›é€‰å€¼ï¼Œç­›é€‰æ–¹æ³•åˆä¸ä¸€æ ·ï¼‰
- å…¶å®ƒæ›´ç‰¹æ®Šäº›çš„ç­›é€‰éƒ½éœ€è¦è‡ªè¡Œæ‹Ÿå¥½ç­›é€‰æ–¹æ³•
- éœ€è¦æ³¨æ„ï¼Œç­›é€‰æ–¹æ³•å‚æ•°ä¸ TableV1 ä¸­çš„ä¸åŒï¼ˆç¤ºä¾‹ä¸­çš„è‡ªå®šä¹‰ç­›é€‰æ–¹æ³•æ˜¯éå†ä¸€éè¡¨æ ¼æ•°æ®ï¼Œè€Œ TableV1 æä¾›çš„ç­›é€‰æ–¹æ³•æ¥å£æ˜¯å¯¹é€‰ä¸­ç­›é€‰å€¼åˆ—è¡¨ä¸­çš„æ¯ä¸ªå€¼ï¼Œéƒ½éå†ä¸€éè¡¨æ ¼æ•°æ®ã€‚å®è´¨æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æ–¹æ³•å‚æ•°ç±»å‹ä¸åŒè€Œå·²ï¼‰

å¦å¤–ï¼Œä¸‹ä¸€èŠ‚æ–¹æ¡ˆäºŒä¸­ï¼Œé€šè¿‡ç»™æºæ•°æ®æ·»åŠ  hidden æ ‡è¯†æ˜¯å¦é€šè¿‡ç­›é€‰ï¼Œæ— éœ€å•ç‹¬è®°å½•ç­›é€‰æ•°æ®ã€‚æ”¹åŠ¨ä¹Ÿå¾ˆç®€å•ï¼Œåˆ é™¤ `originData`ï¼Œ`onFilter` ä¸­æ›´æ–° hidden å±æ€§å€¼ï¼Œè¡¨æ ¼ç»‘å®šæ•°æ®ä¸­è¿›è¡Œç­›é€‰ hidden ä¸ä¸º true çš„ã€‚

#### å…¶å®ƒé™„åŠ åŠŸèƒ½

##### é»˜è®¤ç­›é€‰å€¼ã€ç­›é€‰åˆ—è¡¨å•é€‰

å¦‚ TableV1 ä¸­æä¾›çš„åŠŸèƒ½ï¼Œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ é»˜è®¤ç­›é€‰å€¼ï¼›æœ‰äº›ç­›é€‰é¡¹æˆ‘ä»¬å¸Œæœ›åšæˆå•é€‰çš„å½¢å¼ã€‚

æ¥ä¸Šä¾‹ï¼Œå¯æ›´æ–°ä»£ç å¦‚ä¸‹ï¼š

::: details

```javascript
import CustomSelector from '@/components/custom-selector.vue'

const columnData = ref([
  // ...
  {
    key: 'gender',
    dataKey: 'gender',
    title: 'gender',
    width: 80,
    filterable: true,
    filterSingle: true,
    filteredValue: 'ç”·',
  },
  // ...
])

/**
 * ç­›é€‰ä¿¡æ¯åˆ—è¡¨
 * props:
 * - {Array} list å¯ç­›é€‰å€¼åˆ—è¡¨
 * - {Array} selected å·²å‹¾é€‰åˆ—è¡¨ï¼ˆç­›é€‰å€¼å¤šé€‰æ—¶ä½¿ç”¨ï¼‰
 * - {string} singleSelect å·²å‹¾é€‰å€¼ï¼ˆç­›é€‰å€¼å•é€‰æ—¶ä½¿ç”¨ï¼‰
 * - {Function} [filterMethod] ç­›é€‰æ–¹æ³•
 * - {Array} [filteredValue] é»˜è®¤ç­›é€‰å€¼
 * - {boolean} [filterSingle] ç­›é€‰å€¼å•é€‰ï¼Ÿ
 */
const filterableCols = reactive(
  columnData.value
    .filter(c => c.filterable)
    .reduce((prev, curr) => {
      prev[curr.dataKey] = {
        selected: [],
        list: [],
        singleSelect: undefined,
        filterMethod: curr.filterMethod ?? generalFilterHandler,
        filteredValue: curr.filteredValue,
        filterSingle: curr.filterSingle ?? false,
      }
      return prev
    }, {})
)

const onFilter = () => {
  const allFilters = Object.entries(filterableCols).filter(([_, configs]) => {
    return configs.filterSingle
      ? ![null, undefined].includes(configs.singleSelect)
      : configs.selected?.length > 0
  })
  tableData.value = originData.value.filter(p => {
    return allFilters.every(([dataKey, configs]) => {
      return (
        !configs.filterMethod ||
        configs.filterMethod(
          p[dataKey],
          configs.filterSingle ? configs.singleSelect : configs.selected
        )
      )
    })
  })
}

// è‡ªåŠ¨è·å–å„é¡¹ç­›é€‰åˆ—è¡¨
const getFiltersFromResp = () => {
  for (let dataKey in filterableCols) {
    // ...
    // æ ¹æ®æ˜¯å¦å¤šé€‰ï¼Œè·å–å¯¹åº”é»˜è®¤æ’åºï¼ˆå€¼/åˆ—è¡¨ï¼‰
    filterableCols[dataKey].selected = !filterableCols[dataKey].filterSingle
      ? filterableCols[dataKey].filteredValue instanceof Array
        ? filterableCols[dataKey].filteredValue
        : []
      : []
    filterableCols[dataKey].singleSelect = filterableCols[dataKey].filterSingle
      ? typeof filterableCols[dataKey].filteredValue !== 'object'
        ? filterableCols[dataKey].filteredValue
        : undefined
      : undefined
  }
}

const columns = columnData.value.map(col => {
  return {
    key: col.dataKey,
    title: col.title,
    dataKey: col.dataKey,
    width: col.width ?? 100,
    headerCellRenderer: props => {
      if (!col.filterable) return props.column.title
      return (
        <div class='tbv2-th-filter'>
          <span class='th-cell'>{props.column.title}</span>
          <el-popover trigger='hover' {...{ width: 200 }}>
            {{
              default: () => {
                return filterableCols[col.dataKey].filterSingle ? (
                  <CustomSelector
                    v-model={filterableCols[col.dataKey].singleSelect}
                    onChange={onFilter}
                    list={filterableCols[col.dataKey].list}
                  />
                ) : (
                  <div class='filter-wrapper'>
                    <div class='filter-group'>
                      <el-checkbox-group v-model={filterableCols[col.dataKey].selected}>
                        {filterableCols[col.dataKey].list.map(f => (
                          <el-checkbox key={f.value} label={f.value}>
                            {f.text}
                          </el-checkbox>
                        ))}
                      </el-checkbox-group>
                    </div>
                    <div class='el-table-v2__demo-filter'>
                      <el-button text onClick={onFilter}>
                        Confirm
                      </el-button>
                      <el-button text onClick={() => onReset(col.dataKey)}>
                        Reset
                      </el-button>
                    </div>
                  </div>
                )
              },
              reference: () => (
                <svg
                  viewBox='0 0 1024 1024'
                  xmlns='http://www.w3.org/2000/svg'
                  width='14'
                  height='14'
                  style={{
                    cursor: 'pointer',
                    color: (
                      filterableCols[col.dataKey].filterSingle
                        ? ![null, undefined].includes(filterableCols[col.dataKey].singleSelect)
                        : filterableCols[col.dataKey].selected?.length > 0
                    )
                      ? '#387FE5'
                      : 'inherit',
                  }}>
                  <path
                    fill='currentColor'
                    d='M735.086 796.233c0-15.58 12.727-28.818 28.891-28.818h230.4a29.257 29.257 0 0 1 28.818 28.818 28.891 28.891 0 0 1-28.745 28.818H763.977a29.257 29.257 0 0 1-28.818-28.818zm0-127.927c0-15.506 12.727-28.745 28.891-28.745h230.4a29.257 29.257 0 0 1 28.818 28.745 28.891 28.891 0 0 1-28.745 28.819H763.977a29.257 29.257 0 0 1-28.818-28.819zm28.891-156.672h230.4a29.257 29.257 0 0 1 28.818 28.819 28.891 28.891 0 0 1-28.745 28.818H763.977a29.257 29.257 0 0 1-28.818-28.818 29.257 29.257 0 0 1 28.818-28.819zM901.632 0c50.176 0 122.149 49.006 121.051 127.927 1.098 35.694-13.897 66.267-42.642 96.768-216.064 189.586-300.178 227.62-306.468 285.257-5.267 45.495-1.829 472.357-2.926 478.135a39.497 39.497 0 0 1-5.778 22.455c-18.432 18.432-37.45 12.141-47.25 4.023-72.046-58.734-232.741-189.514-251.173-228.133-21.358-41.472-13.24-126.757-13.24-276.48 0-34.085-253.512-235.154-308.296-285.257C31.744 210.285 0 181.54 0 128 0 49.59 63.927 0 134.802 0h766.83zM76.069 164.79c1.682 2.341 4.022 5.12 6.875 8.047l8.63 8.63-3.437-3.437a9235.017 9235.017 0 0 0 147.53 125.074l14.92 12.654c134.29 115.2 167.132 147.456 167.132 194.706 0 27.648 0 51.273-.585 88.137-1.756 114.103 0 145.774 8.045 161.353 3.438 6.876 47.836 49.518 108.325 101.961l17.262 14.41c32.914 27.648 57.051 54.125 57.051 51.273V747.813c0-139.996.585-221.184 3.438-244.298 1.755-13.165 5.193-25.892 10.386-38.034 15.58-35.108 40.96-59.246 105.472-111.689l89.234-72.046c40.375-34.596 81.262-69.12 121.637-104.887l-4.608 4.096c19.017-20.187 25.893-35.181 25.307-53.613C959.27 93.915 926.501 64 901.632 64h-766.83c-41.472 0-70.875 26.478-70.875 63.927 0 14.994 4.023 25.892 12.142 36.864z'
                  />
                </svg>
              ),
            }}
          </el-popover>
        </div>
      )
    },
  }
})
```

CustomSelector ç»„ä»¶ï¼šå•é€‰åˆ—è¡¨ï¼ˆå±•å¼€çš„ el-select ï¼‰

```html
<script setup>
  const props = defineProps({
    modelValue: { default: '' },
    list: { type: Array, default: [] },
  })

  const emit = defineEmits(['change', 'update:modelValue'])

  function handleOptionClick(val) {
    if (props.modelValue === val) return
    emit('update:modelValue', val)
    emit('change', val)
  }
</script>
<template>
  <div class="wrap">
    <div
      v-for="option in list"
      :key="option.value"
      :class="['item', { active: modelValue === option.value }]"
      @click="handleOptionClick(option.value)">
      {{ option.text }}
    </div>
  </div>
</template>
<style lang="scss" scoped>
  .wrap {
    width: 100%;
    font-size: 14px;
    color: #666;
    .item {
      line-height: 32px;
      padding: 0 12px;
      cursor: pointer;
      &.active {
        color: #387fe5;
        font-weight: bold;
      }
      &:hover {
        background-color: #f9f9f9;
      }
    }
  }
</style>
```

:::

##### å¤šé€‰æ—¶ï¼Œä¸ç‚¹å‡»ç¡®å®š

å•é€‰ç»„ä»¶è®¾ç½®äº†ç›‘å¬äº‹ä»¶ï¼Œæ— éœ€ç‚¹å‡»ç¡®å®šå³å¯è§¦å‘ç­›é€‰äº‹ä»¶

è€Œå¤šé€‰ä½¿ç”¨çš„å¤šé€‰æ¡†ç»„ï¼Œå­˜å‚¨é€‰ä¸­ç­›é€‰å€¼çš„å˜é‡æ˜¯ç›´æ¥ç»‘å®šåˆ°ç»„ä»¶ä¸Šçš„ï¼Œç¤ºä¾‹ä¸­é€šè¿‡ç‚¹å‡»ç¡®å®šæŒ‰é’®æ‰‹åŠ¨è§¦å‘ç­›é€‰äº‹ä»¶ï¼Œä¸ç‚¹å‡»ä¼šå¯¼è‡´çš„ UI ä¸å®é™…ç­›é€‰ä¸ç¬¦çš„é—®é¢˜

æƒ³åˆ°ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œä¸€æ˜¯ä½¿ç”¨å¤šé€‰æ¡†ç»„æä¾›çš„ `change` äº‹ä»¶ï¼Œä»£ä»·æ˜¯å¯èƒ½ä¼šç­›é€‰è¿‡äºé¢‘ç¹ã€‚å¦ä¸€ç§æ˜¯åˆ›å»ºä¸€ä¸ªå˜é‡å­˜å‚¨å‰ä¸€æ¬¡ç­›é€‰çŠ¶æ€ï¼Œæ¯æ¬¡æ‰§è¡Œç­›é€‰å‰ä¸å½“å‰ç­›é€‰çŠ¶æ€è¿›è¡Œå¯¹æ¯”ï¼Œç›¸åŒåˆ™ä¸æ‰§è¡Œç­›é€‰

æ–¹æ¡ˆä¸€ï¼šæ›´æ–° `headerCellRenderer`

`<el-checkbox-group v-model={ filterableCols[col.dataKey].selected }>`

â†“â†“â†“â†“â†“

`<el-checkbox-group v-model={ filterableCols[col.dataKey].selected } onChange={ onFilter }>`

æ–¹æ¡ˆäºŒï¼š

```javascript
const prevFilters = ref([])
const compareFilters = currFilters => {
  return (
    prevFilters.value.length === currFilters.length &&
    prevFilters.value.every((f, idx) => {
      let [currDataKey, { selected: currSelected, singleSelect: currSingleSelect }] =
        currFilters[idx]
      currSelected = currSelected.slice(0).sort()
      return (
        f.dataKey === currDataKey &&
        f.singleSelect === currSingleSelect &&
        f.selected
          .slice(0)
          .sort()
          .every((p, idx1) => p === currSelected[idx1])
      )
    })
  )
}

const onFilter = () => {
  // const allFilters = ...
  if (compareFilters(allFilters)) return
  prevFilters.value = allFilters.map(([dataKey, configs]) => ({
    dataKey,
    selected: configs.selected,
    singleSelect: configs.singleSelect,
  }))
  // ...
}
```

## å…­ã€æ’åºã€ç­›é€‰åŒæ—¶ä½¿ç”¨

æŒ‰å‰ä¸¤èŠ‚ç¤ºä¾‹ï¼Œæ’åºã€ç­›é€‰å½“ç„¶å¯ä»¥åŒæ—¶å®ç°ï¼Œä½†éœ€è¦å¤„ç†æ•°æ®ä¸Šå†²çª

### é—®é¢˜åˆ†æ

ä¸¤éƒ¨åˆ†çš„ç¤ºä¾‹ä¸­ï¼Œéƒ½ä½¿ç”¨äº† originData è®°å½•è¡¨æ ¼åŸå§‹æ•°æ®ï¼š

å¦‚æœä¸ä¿å­˜æºæ•°æ®ï¼Œåœ¨æ’åºä¸­ï¼Œä¸å…‰æ— æ³•ç½®ç©ºæ’åºã€å›å½’åŸé¡ºåºï¼Œä¸åŒæ’åºé¡¹çš„å†å²æ’åºå½±å“ä¹Ÿä¼šæŒç»­ä¸‹å»ï¼Œå…¶å®æ˜¯éš¾ä»¥é¢„æ–™çš„å¤šé‡æ’åºç»“æœã€‚ç­›é€‰æ“ä½œä¹Ÿå˜æˆäº†åŸºäºä¸Šä¸€æ¬¡ç­›é€‰ç»“æœçš„ç­›é€‰

```javascript
const tableData = ref([])
const originData = ref([])

// handle sort
tableData.value = originData.value.slice(0).sort(sortMethod)
// handle filter
tableData.value = originData.value.filter(filterMethod)
```

ä¸¤è€…éƒ½æ˜¯åŸºäºæºè¡¨æ ¼æ•°æ®è¿›è¡Œæ’åºã€ç­›é€‰ã€‚ä¸¤ä¸ªåŠŸèƒ½åŒæ—¶å­˜åœ¨æ—¶ï¼Œå°±æœ‰å†²çªäº†ï¼Œä¼šå½¼æ­¤å¹²æ‰°æ­¤å‰çš„æ“ä½œã€‚

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆä¸€ï¼šåˆ›å»ºä¸­é—´å˜é‡

é¢å¤–åˆ›å»ºä¸€ä¸ªå˜é‡ `tempData`ï¼Œç”¨å®ƒè®°å½•ç­›é€‰åçš„æ•°æ®ï¼ŒtableData è®°å½•æ’åºåçš„å€¼

`originData` -> `tempData` -> `tableData`

- `originData` æ›´æ–°æ—¶ï¼Œ`tempData`, `tableData` é‡ç½®ä¸º `originData`
- ç­›é€‰æ—¶ï¼ŒåŸºäºæºæ•°æ®ç­›é€‰ï¼ˆ`originData` -> `tempData`ï¼‰ï¼Œ`tableData` é‡ç½®ä¸º `tempData`
- æ’åºæ—¶ï¼ŒåŸºäº `tempData` æ’åºï¼ˆ`tempData` -> `tableData`ï¼‰

çœ‹èµ·æ¥æœ‰ç‚¹ç»•ï¼Œå…¶å®å°±ä¸¤æ¡ä¾èµ–å…³ç³»ï¼Œæ·»åŠ ä¸¤ä¸ªç›¸åº”çš„ `watch` å°±å¯ä»¥äº†

```html
<el-table-v2 :data="tableData" ... />
```

```js {2,6,12}
const tableData = ref([]) // è¡¨æ ¼å½“å‰æ•°æ®ï¼ˆæ’åºã€ç­›é€‰åï¼‰
const tempData = ref([]) // ä¸­é—´å˜é‡ï¼Œå¯¹æºæ•°æ®çš„ç­›é€‰
const originData = ref([]) // è¡¨æ ¼æºæ•°æ®

// æºæ•°æ®æ›´æ–° -> æ›´æ–°ç­›é€‰é¡¹å„è‡ªçš„å¯ç­›é€‰åˆ—è¡¨, æ‰§è¡Œç­›é€‰
watch(originData, newVal => {
  getFiltersFromResp()
  onFilter() // æ‰§è¡Œç­›é€‰ä¼šæ›´æ–° tempData
})
// æ’åºçŠ¶æ€æ›´æ–° | tempData æ›´æ–° -> æ‰§è¡Œæ’åº
watch(
  [sortState, tempData],
  ([newState, newData]) => {
    // handle sort ( originData --sort--> tableData )
    const { key, order } = newState ?? {}
    // æ•°æ®ä¸ºç©º | å½“å‰æ— æ’åºï¼Œé‡ç½® tableData
    if (!newData?.length || !key || !order) {
      tableData.value = newData
      return
    }
    // ...
    tableData.value = newData.slice(0).sort(sortMethod)
  },
  { immediate: true }
)

// handle filter
const onFilter = () => {
  // ...
  tempData.value = originData.value.filter(execFilter)
}
```

#### æ–¹æ¡ˆäºŒï¼šæºæ•°æ®ä¸­æ·»åŠ ç­›é€‰æ ‡è¯†

ç­›é€‰äº‹ä»¶å¤„ç†æ–¹æ³•ä¸­ï¼Œæ ‡è¯†æ•°æ®æ˜¯å¦é€šè¿‡ç­›é€‰(ä¾‹å¦‚ï¼šæ·»åŠ  hidden å±æ€§)ï¼Œä¸æ–¹æ¡ˆä¸€ç›¸æ¯”ï¼Œä»£ç æ”¹åŠ¨è¾ƒå°ï¼š

```js {16}
const tableData = ref([]) // è¡¨æ ¼å½“å‰æ•°æ®ï¼ˆæ’åºã€ç­›é€‰åï¼‰
// const tempData = ref([])   // ä¸­é—´å˜é‡ï¼Œå¯¹æºæ•°æ®çš„ç­›é€‰ // [!code --]
const originData = ref([]) // è¡¨æ ¼æºæ•°æ®

// æºæ•°æ®æ›´æ–° -> æ›´æ–°ç­›é€‰é¡¹å„è‡ªçš„å¯ç­›é€‰åˆ—è¡¨, æ‰§è¡Œç­›é€‰
watch(originData, newVal => {
  getFiltersFromResp()
  onFilter()
})
// æ’åºçŠ¶æ€æ›´æ–° | originData æ›´æ–°(åŒ…æ‹¬ hidden æ›´æ–°) -> æ‰§è¡Œæ’åº
watch(
  [sortState, originData], // [sortState, tempData],
  ([newState, newData]) => {
    const { key, order } = newState ?? {}
    if (!newData?.length || !key || !order) {
      tableData.value = newData?.filter(p => !p.hidden) ?? [] // newData
      return
    }
    // ...
    // tableData.value = newData.slice(0).sort(sortMethod)
    tableData.value = newData.filter(p => !p.hidden).sort(sortMethod)
  },
  { immediate: true, deep: true } // { immediate: true }
)

const onFilter = () => {
  // ...
  // tempData.value = originData.value.filter(execFilter) // [!code --]
  originData.value.forEach(val => { // [!code ++]
    val.hidden = !execFilter(val) // [!code ++]
  }) // [!code ++]
}
```

æ— ä¸­é—´å˜é‡ï¼ŒoriginData æ·»åŠ  hidden å±æ€§

ç›¸æ¯”ä¹‹ä¸‹ï¼Œå°‘ä¸€æ¡ä¾èµ–ï¼Œä»£ç ç®€å•ä¸€ç‚¹ã€‚æ’åºå’Œç­›é€‰å…¶å®è¿˜éƒ½æ˜¯åŸºäºæºæ•°æ®ï¼Œåªæ˜¯ä½¿ç”¨ hidden å±æ€§è¿‡æ»¤ TableV2 çš„ç»‘å®šæ•°æ®

æ­¤æ–¹æ³•åŒæ ·å¯ä»¥åº”ç”¨åœ¨ä¸Šä¸€èŠ‚å•ç‹¬ä½¿ç”¨ç­›é€‰åŠŸèƒ½æ—¶ï¼Œå¯ä»¥åšåˆ°åªä½¿ç”¨æºæ•°æ®ã€‚

**ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”ï¼š**

ç¬¬äºŒç§æ–¹æ¡ˆä¸­ï¼Œä¸ºäº†ç›‘å¬åˆ°æºæ•°æ® hidden çš„å˜åŒ–ï¼Œè¿›è¡Œäº†æ·±å±‚ç›‘å¬ã€‚å¦‚æœå…·ä½“ä¸šåŠ¡ä¸­æœ‰å…¶å®ƒé€»è¾‘éœ€è¦é¢‘ç¹æ”¹åŠ¨æºæ•°æ®å…¶å®ƒå±æ€§ï¼Œå°†ä¼šé€ æˆä¸å¿…è¦çš„æ›´æ–°æ’åºã€ç­›é€‰ã€‚

tempDataã€tableData ä»…ä»…æ˜¯å¯¹åˆ—è¡¨æ•°æ®å†…å¯¹è±¡å¼•ç”¨çš„æ‹·è´ï¼Œé€»è¾‘å¤„ç†å¥½å°±è¡Œï¼Œä¸å­˜åœ¨å¯¹å¤§æ‰¹é‡æ•°æ®çš„å¤„ç†è€—æ—¶é—®é¢˜ã€‚

### å…¶ä»–

ä¸ºäº†çªå‡ºæ’åºå·²ç”Ÿæ•ˆï¼Œå¯ä»¥åŠ ä¸Šæ ·å¼

`.el-table-v2__header-cell .el-table-v2__sort-icon.is-sorting {color:#387FE5}`

## ä¸ƒã€å‘

**å½“è®¾ç½®äº†åŠ¨æ€é«˜åº¦è¡Œï¼ˆ`estimated-row-height`ï¼‰æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿä¸¥é‡çš„å¡é¡¿ç°è±¡ï¼ï¼ˆä¸è¡¨æ ¼æ•°æ®æ€»æ•°æ— å…³ï¼‰**

è°ƒè¯•å‘ç°ï¼Œç›®å‰ TableV2 æ¯æ»šåŠ¨ä¸€æ¬¡å°±é‡æ–°åŠ è½½ä¸€æ¬¡è¡¨æ ¼å†…åŠé¢„åŠ è½½çš„è¡Œæ•°ï¼Œæ€»å•å…ƒæ ¼è¿‡å¤šæ—¶ï¼Œä¼šè®©ä½“éªŒæ„Ÿåœ¨ä¸Šé¢çš„åœºæ™¯ä¸‹å˜å¾—æå·®ã€‚

ä»¥æœ¬äººå®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„ä¸€ä¸ªè¡¨æ ¼ä¸ºä¾‹ï¼Œè¡¨æ ¼ä¸€è¡Œæœ‰ 17 ä¸ªçš„å•å…ƒæ ¼ï¼Œä¸€é¡µæ˜¾ç¤º 20 æ¡æ•°æ®ï¼Œé¢„å…ˆå¤šåŠ è½½çš„è¡Œæ•°æ˜¯ 2ï¼Œæ¯ä¸€æ¬¡éœ€è¦æ¸²æŸ“ 17\*24=408 ä¸ªå•å…ƒæ ¼ã€‚è¿ç»­çºµå‘æ»šåŠ¨ä¼šè§¦å‘å¤šæ¬¡è¡¨æ ¼å†…å®¹åŠ è½½ï¼Œè½»å¾®å¡é¡¿ï¼Œæœ‰å¾…ä¼˜åŒ–ï¼Œæ„Ÿè§‰å¯ä»¥æä¾›ä¸€ä¸ªå±æ€§ä½œä¸ºè¿ç»­æ»šåŠ¨çš„èŠ‚æµå¤„ç†å¼€å…³ã€‚å¦ä¸€æ–¹é¢å°±æ˜¯å…¨éƒ¨é‡æ–°åŠ è½½è¿™ä¸ªç­–ç•¥ã€‚

ä¸Šé¢è¯´çš„æ˜¯æ­£å¸¸æµç¨‹ï¼Œä¸æ­£å¸¸çš„æ˜¯ï¼Œå½“è®¾ç½®äº†åŠ¨æ€é«˜åº¦ä¸”è¶…å‡ºè®¾å®šé«˜åº¦çš„è¡Œæ•°ä¸å°‘æ—¶ï¼Œä¸€æ¬¡æ»šåŠ¨å°±ä¼šé‡å¤è§¦å‘å››äº”æ¬¡ï¼Œå†åŠ ä¸Šè¿ç»­æ»šåŠ¨ã€‚å‡è®¾ä¸€ä¸ªåªè§¦å‘ä¸‰æ¬¡çš„è¿ç»­æ»šåŠ¨ï¼Œ408\*4\*3=4896 ä¸ªå•å…ƒæ ¼æ¸²æŸ“ã€‚å¦‚æœä½ å¤Ÿå¹´è½»ï¼Œæ‰‹é€Ÿå¤Ÿå¿«ï¼Œè½»æ¾ç ´ä¸‡ã€‚å†åŠ ä¸Šï¼ŒæŸäº›è‡ªå®šä¹‰æ¸²æŸ“çš„å•å…ƒæ ¼å¤Ÿâ€œå¤§â€å¤Ÿâ€œé‡â€ï¼Œé‚£ã€‚ã€‚ã€‚

è¿™ä¸ªé—®é¢˜åº”è¯¥æ˜¯ä¸ª bugï¼Œå¸Œæœ›åç»­ç‰ˆæœ¬èƒ½ä¿®å¤

## å…«ã€æ€»ç»“

**ä½ çœŸçš„éœ€è¦è™šæ‹ŸåŒ–è¡¨æ ¼å—ï¼Ÿ**

è™šæ‹ŸåŒ–è¡¨æ ¼ä¸æ˜¯ä¸€ä¸ªå¯ä»¥æ— è„‘ä½¿ç”¨çš„æ–¹æ¡ˆï¼Œ`element-plus` çš„è™šæ‹ŸåŒ–è¡¨æ ¼ç”šè‡³å®˜æ–¹éƒ½ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚

æœ€ç®€å•çš„ï¼Œå¦‚æœéœ€æ±‚å…è®¸åˆ†é¡µå±•ç¤ºé‚£å°±ä¸è¦ä½¿ç”¨è™šæ‹ŸåŒ–è¡¨æ ¼ï¼ä¸€æ–¹é¢ï¼ŒTableV1å®Œå…¨æ”¯æŒåç«¯ç­›é€‰ã€æ’åºã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæƒ³é¿å…é¢‘ç¹è¯·æ±‚ï¼Œæœ€å¤šå°±å‡ åƒæ¡æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¸€æ¬¡è¯·æ±‚æ‰€æœ‰æ•°æ®ï¼Œå‰ç«¯è¡¨æ ¼åˆ†é¡µã€å‰ç«¯ç­›é€‰æ’åºã€‚

**è¡¨æ ¼æ€§èƒ½ä¼˜åŒ–ï¼š**

å½“æ³¨æ„åˆ°è¡¨æ ¼æ¸²æŸ“è€—æ—¶è¿‡é•¿æ—¶ï¼Œé¦–å…ˆè¦å»åˆ†æè€—æ—¶çš„åŸå› ã€‚å¦‚æœåªæ˜¯çº¯æ–‡å­—å±•ç¤ºï¼Œä¸€ä¸¤åƒè¡Œå¯èƒ½éƒ½å¾ˆå¿«ï¼Œå¦‚æœå•å…ƒæ ¼å†…å®¹è¿‡äºä¸°å¯Œï¼Œä¸€ä¸¤ç™¾æ¡å°±èƒ½è®©é¡µé¢å¡ä¸Šå‡ ç§’ã€‚

æ‰“ä¸ªæ¯”æ–¹ï¼Œä¸€ä¸ªè¡¨æ ¼å†…ï¼Œå„æœ‰ä¸€é¡¹å•å…ƒæ ¼åŒ…å«`el-popover`ã€`el-tooltip`ï¼Œå‰è€…çš„ä»£ä»·æ›´å¤§ï¼Œè€Œåè€…åˆè¿œä¸å¦‚åŸç”Ÿ`title`å±æ€§æ–¹æ¡ˆã€‚è¡¨æ ¼å†…æœ‰ä¸€é¡¹è°ƒç”¨`el-dialog`ï¼Œå°½ç®¡ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„æ¨¡æ€æ¡†è€—æ—¶è¿œå¤§äºå¼¹å‡ºæ¡†ï¼Œä½†æ•´é¡¹å…±ç”¨ä¸€ä¸ªã€‚å‰é¢æåˆ°çš„ä¸¤ç§å¼¹å‡ºæ¡†å´æ˜¯è¯¥é¡¹å†…æ¯ä¸ªå•å…ƒæ ¼ç‹¬äº«ä¸€ä¸ªå¼¹å‡ºæ¡†ç»„ä»¶ï¼Œæ­¤å¤„è€—æ—¶éšè¡¨æ ¼æ•°é‡çº¿æ€§å¢é•¿ã€‚å¯ä»¥é€‰æ‹©ä½¿ç”¨åŸç”Ÿ`title`å±æ€§ä½œä¸ºæ›¿æ¢æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå¼¹å‡ºæ¡†ç»„ä»¶åœ¨è¡¨æ ¼å†…å…¬ç”¨ï¼Œç­‰ç­‰ã€‚

**Element Plus è™šæ‹ŸåŒ–è¡¨æ ¼åˆ†æï¼š**

TableV2 åªåŠ è½½å¯è§åŒºåŸŸä»¥åŠå‰åé¢„åŠ è½½(å¯è®¾ç½®)çš„â€œè¡Œâ€ï¼Œçºµå‘æ»šåŠ¨åå…¨éƒ¨é‡æ–°åŠ è½½ä¸€éã€‚åªè¦æ•°æ®æ‹¿åˆ°äº†ï¼Œè¡¨æ ¼çš„åŠ è½½é€Ÿåº¦å¾ˆå¿«ï¼Œå¯¹è¡¨æ ¼çš„ä¸€äº›å“åº”å¼æ“ä½œååº”ä¹Ÿå¾ˆå¿«ï¼Œå¦‚æœè¡¨æ ¼æ•°æ®é‡å¯èƒ½åœ¨å‡ åƒè¡ŒåŠä»¥ä¸Šï¼Œå¾ˆæœ‰å¿…è¦æ¢æ‰ TableV1ã€‚

TableV2 çš„é—®é¢˜åœ¨äºå®ƒç›®å‰æ˜¯**å…¨éƒ¨é‡æ–°åŠ è½½**ï¼Œå“ªæ€•æ˜¯çºµå‘æ»‘åŠ¨äº†ä¸€åƒç´ ã€‚

å½“å•å…ƒæ ¼è¿‡é‡æ—¶ï¼Œå°½ç®¡ä½¿ç”¨äº†è™šæ‹ŸåŒ–è¡¨æ ¼æ–¹æ¡ˆï¼Œä»ç„¶ä¼šå¯¼è‡´ä½¿ç”¨ä½“éªŒå·®ï¼Œä½“ç°ä¸ºæ»šåŠ¨ä¸æµç•…ã€è‚‰çœ¼èƒ½å¯Ÿè§‰çš„é—ªçƒã€‚è¿™ç§éœ€æ±‚åœºæ™¯ä¸‹ï¼Œå¦‚æœæ— æ³•è°ƒæ•´éœ€æ±‚ï¼Œå»ºè®®æ¢å·¥å…·ã€‚

**å…¶å®ƒè™šæ‹ŸåŒ–è¡¨æ ¼ï¼š**

å·²ç»æœ‰å¾ˆå¤šè™šæ‹ŸåŒ–è¡¨æ ¼å·¥å…·äº†ï¼Œè¿™é‡Œåˆ—ä¸¾ä¸¤ä¸ªåŠŸèƒ½å®Œå–„ã€æ€§èƒ½æ›´å¼ºæˆ–ä½“éªŒæ›´å¥½çš„ï¼š

[rsuite-table](https://github.com/rsuite/rsuite-table) æ–¹æ¡ˆä¸åŒä¹‹å¤„åœ¨äºä»åœ¨å¯è§†èŒƒå›´å†…çš„è¡Œä¿æŒä¸å˜ï¼Œä»…ä½œå¿…è¦çš„å¢åˆ ï¼ˆåœ¨ä½¿ç”¨EPçš„æ—¶å€™å°±å¾ˆç–‘æƒ‘ä¸ºä»€ä¹ˆä¸è¿™ä¹ˆåšï¼‰ã€‚å¯æƒœå®ƒæ˜¯ React è¡¨æ ¼ç»„ä»¶

[ag-grid](https://www.ag-grid.com/): å½±å“åŠ›å¤§ä¸”æå—æ¬¢è¿çš„é«˜æ€§èƒ½è¡¨æ ¼ç»„ä»¶ï¼ŒåŠŸèƒ½å®Œå¤‡ï¼Œæ”¯æŒjsåŸç”Ÿè°ƒç”¨ï¼Œä¹Ÿæ”¯æŒ vue/react/angular æ¡†æ¶ã€‚æ»šåŠ¨æ—¶åŒæ ·ä»…ä½œå¿…è¦çš„å¢åˆ ã€‚ä½¿ç”¨å®ƒçš„ä»£ä»·å°±æ˜¯ä¾èµ–åŒ…ä¼šæ¯”è¾ƒå¤§ã€‚
